<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>API Performance Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwindcss.config = {
            darkMode: "class",
        };
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/framer-motion/10.16.4/framer-motion.min.js"></script>
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");

        * {
            font-family: "Inter", sans-serif;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .row-hover {
            transition: all 0.3s ease;
        }

        .row-hover:hover {
            transform: translateX(5px);
        }

        .status-badge {
            transition: all 0.3s ease;
        }

        .status-badge:hover {
            transform: scale(1.05);
        }

        .theme-transition {
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid #3b82f6;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .metric-card {
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .scrollbar-custom::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .scrollbar-custom::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .scrollbar-custom::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }

        .scrollbar-custom::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .dark .scrollbar-custom::-webkit-scrollbar-track {
            background: #374151;
        }

        .dark .scrollbar-custom::-webkit-scrollbar-thumb {
            background: #6b7280;
        }

        .dark .scrollbar-custom::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 50;
            min-width: 200px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
        }

        .dark .dropdown-menu {
            background: #1f2937;
            border-color: #374151;
        }

        .dropdown-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-menu button {
            width: 100%;
            text-align: left;
            padding: 10px 16px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 14px;
            color: #374151;
            transition: background-color 0.2s ease;
        }

        .dark .dropdown-menu button {
            color: #d1d5db;
        }

        .dropdown-menu button:hover {
            background-color: #f3f4f6;
        }

        .dark .dropdown-menu button:hover {
            background-color: #374151;
        }

        .dropdown-menu button:first-child {
            border-radius: 8px 8px 0 0;
        }

        .dropdown-menu button:last-child {
            border-radius: 0 0 8px 8px;
        }

        .dropdown-container {
            position: relative;
        }

        .dropdown-trigger {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-size: 14px;
            color: #374151;
            transition: all 0.2s ease;
        }

        .dark .dropdown-trigger {
            background: #1f2937;
            border-color: #374151;
            color: #d1d5db;
        }

        .dropdown-trigger:hover {
            border-color: #9ca3af;
        }

        .dark .dropdown-trigger:hover {
            border-color: #6b7280;
        }

        .dropdown-trigger.active {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
    </style>
</head>

<body class="theme-transition bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100">
    <!-- Header -->
    <header class="theme-transition bg-white dark:bg-gray-800 top-0">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-chart-line text-3xl text-blue-600 dark:text-blue-400"></i>
                    <div>
                        <h1 class="text-2xl font-bold">API Performance Dashboard</h1>
                        <p class="text-sm text-gray-600 dark:text-gray-400">
                            Real-time API Monitoring
                        </p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="procurementBtn"
                        class="px-4 py-2 rounded-lg bg-blue-600 dark:bg-blue-500 hover:bg-blue-700 dark:hover:bg-blue-600 text-white font-medium transition-all duration-300 flex items-center space-x-2">
                        <i class="fas fa-flask"></i>
                        <span>Procurement Test</span>
                    </button>
                    <button id="themeToggle"
                        class="p-3 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-all duration-300">
                        <i class="fas fa-moon text-xl dark:hidden"></i>
                        <i class="fas fa-sun text-xl hidden dark:inline"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Loading State -->
    <div id="loading" class="flex items-center justify-center min-h-screen">
        <div class="text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-600 dark:text-gray-400">Loading API Data...</p>
        </div>
    </div>

    <!-- Main Content -->
    <main id="mainContent" class="hidden container mx-auto px-6 py-8">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div
                class="metric-card theme-transition bg-white dark:bg-gray-800 rounded-xl   p-6 border-l-4 border-blue-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 dark:text-gray-400 font-medium">
                            Total APIs
                        </p>
                        <p id="totalApis" class="text-3xl font-bold text-blue-600 dark:text-blue-400 mt-2">
                            0
                        </p>
                    </div>
                    <i class="fas fa-server text-4xl text-blue-500 opacity-20"></i>
                </div>
            </div>

            <div
                class="metric-card theme-transition bg-white dark:bg-gray-800 rounded-xl   p-6 border-l-4 border-green-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 dark:text-gray-400 font-medium">
                            Healthy APIs
                        </p>
                        <p id="healthyApis" class="text-3xl font-bold text-green-600 dark:text-green-400 mt-2">
                            0
                        </p>
                    </div>
                    <i class="fas fa-check-circle text-4xl text-green-500 opacity-20"></i>
                </div>
            </div>

            <div
                class="metric-card theme-transition bg-white dark:bg-gray-800 rounded-xl   p-6 border-l-4 border-red-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 dark:text-gray-400 font-medium">
                            Critical Issues
                        </p>
                        <p id="criticalApis" class="text-3xl font-bold text-red-600 dark:text-red-400 mt-2">
                            0
                        </p>
                    </div>
                    <i class="fas fa-exclamation-triangle text-4xl text-red-500 opacity-20"></i>
                </div>
            </div>

            <div
                class="metric-card theme-transition bg-white dark:bg-gray-800 rounded-xl   p-6 border-l-4 border-yellow-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 dark:text-gray-400 font-medium">
                            Avg Response
                        </p>
                        <p id="avgResponse" class="text-3xl font-bold text-yellow-600 dark:text-yellow-400 mt-2">
                            0ms
                        </p>
                    </div>
                    <i class="fas fa-clock text-4xl text-yellow-500 opacity-20"></i>
                </div>
            </div>
        </div>

        <!-- Filter and Search -->
        <div class="theme-transition bg-white dark:bg-gray-800 rounded-xl   p-6 mb-8">
            <div class="flex flex-col md:flex-row gap-4">
                <div class="flex-1">
                    <div class="relative">
                        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input type="text" id="searchInput" placeholder="Search APIs by name or URL..."
                            class="w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" />
                    </div>
                </div>
                <div class="dropdown-container">
                    <button id="filterStatusTrigger" class="dropdown-trigger w-full md:w-auto">
                        <span id="filterStatusLabel">All Status</span>
                        <i class="fas fa-chevron-down ml-2"></i>
                    </button>
                    <div id="filterStatusMenu" class="dropdown-menu">
                        <button data-value="all">All Status</button>
                        <button data-value="healthy">Healthy (< 2s)</button>
                        <button data-value="warning">Warning (2-5s)</button>
                        <button data-value="critical">Critical (> 5s)</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- API Table -->
        <div class="theme-transition bg-white dark:bg-gray-800 rounded-xl   overflow-hidden">
            <div class="overflow-x-auto scrollbar-custom">
                <table class="w-full">
                    <thead class="bg-gray-50 dark:bg-gray-700">
                        <tr>
                            <th
                                class="px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider">
                                <i class="fas fa-hashtag mr-2"></i>API Name
                            </th>
                            <th
                                class="px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider">
                                <i class="fas fa-tachometer-alt mr-2"></i>Avg Time
                            </th>
                            <th
                                class="px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider">
                                <i class="fas fa-compress-alt mr-2"></i>Min
                            </th>
                            <th
                                class="px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider">
                                <i class="fas fa-expand-alt mr-2"></i>Max
                            </th>
                            <th
                                class="px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider">
                                <i class="fas fa-chart-bar mr-2"></i>P90
                            </th>
                            <th
                                class="px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider">
                                <i class="fas fa-chart-line mr-2"></i>P95
                            </th>
                            <th
                                class="px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider">
                                <i class="fas fa-percentage mr-2"></i>Success Rate
                            </th>
                            <th
                                class="px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider">
                                <i class="fas fa-info-circle mr-2"></i>Status
                            </th>
                        </tr>
                    </thead>
                    <tbody id="apiTableBody" class="divide-y divide-gray-200 dark:divide-gray-700">
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Performance Issues Section -->
        <div id="issuesSection" class="mt-8 theme-transition bg-white dark:bg-gray-800 rounded-xl   p-6">
            <h2 class="text-xl font-bold mb-4 flex items-center">
                <i class="fas fa-exclamation-circle text-red-500 mr-3"></i>
                Critical Performance Issues
            </h2>
            <div id="issuesList" class="space-y-4">
                <!-- Issues will be populated here -->
            </div>
        </div>
    </main>

    <script>
        let currentFilterStatus = "all";

        // Theme Toggle Fix
        function initTheme() {
            const themeToggle = document.getElementById("themeToggle");
            const htmlElement = document.documentElement;

            const savedTheme = localStorage.getItem("theme");
            if (savedTheme === "dark") {
                htmlElement.classList.add("dark");
            } else {
                htmlElement.classList.remove("dark");
            }

            themeToggle.addEventListener("click", () => {
                if (htmlElement.classList.contains("dark")) {
                    htmlElement.classList.remove("dark");
                    localStorage.setItem("theme", "light");
                } else {
                    htmlElement.classList.add("dark");
                    localStorage.setItem("theme", "dark");
                }
            });
        }

        // GitHub Style Dropdown
        function initDropdown() {
            const trigger = document.getElementById("filterStatusTrigger");
            const menu = document.getElementById("filterStatusMenu");
            const buttons = menu.querySelectorAll("button");

            trigger.addEventListener("click", (e) => {
                e.stopPropagation();
                menu.classList.toggle("active");
                trigger.classList.toggle("active");
            });

            buttons.forEach(btn => {
                btn.addEventListener("click", (e) => {
                    const value = btn.dataset.value;
                    currentFilterStatus = value;
                    document.getElementById("filterStatusLabel").textContent = btn.textContent;
                    menu.classList.remove("active");
                    trigger.classList.remove("active");
                    filterAndDisplay();
                });
            });

            document.addEventListener("click", () => {
                menu.classList.remove("active");
                trigger.classList.remove("active");
            });
        }

        // Procurement Button
        document.getElementById("procurementBtn").addEventListener("click", () => {
            window.location.href = "pr.html";
        });

        // Fetch and Display Data
        let allApiData = [];

        async function loadData() {
            try {
                const response = await fetch("./api.data.json");
                const data = await response.json();
                allApiData = data.apis;

                displayStats(data);
                displayApiTable(allApiData);
                displayIssues(data.summary.performanceIssues);

                document.getElementById("loading").classList.add("hidden");
                document.getElementById("mainContent").classList.remove("hidden");
                document.getElementById("mainContent").classList.add("fade-in");
            } catch (error) {
                console.error("Error loading data:", error);
                document.getElementById("loading").innerHTML = `
                    <div class="text-center">
                        <i class="fas fa-exclamation-circle text-5xl text-red-500 mb-4"></i>
                        <p class="text-red-600 dark:text-red-400">Error loading data. Please ensure api.data.json is in the same directory.</p>
                    </div>
                `;
            }
        }

        function displayStats(data) {
            document.getElementById("totalApis").textContent =
                data.summary.totalApis;

            const healthyApis = allApiData.filter((api) => {
                const avgTime = parseFloat(api.avgResTime);
                return avgTime < 2000;
            }).length;
            document.getElementById("healthyApis").textContent = healthyApis;

            document.getElementById("criticalApis").textContent =
                data.summary.performanceIssues.length;

            const totalAvg =
                allApiData.reduce((sum, api) => {
                    return sum + parseFloat(api.avgResTime);
                }, 0) / allApiData.length;
            document.getElementById("avgResponse").textContent =
                totalAvg.toFixed(0) + "ms";
        }

        function getStatusInfo(avgTime, successRate) {
            const time = parseFloat(avgTime);
            const rate = successRate ? parseInt(successRate) : 100;

            if (time > 5000 || rate < 50) {
                return {
                    class: "bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",
                    icon: "fa-times-circle",
                    text: "Critical",
                };
            } else if (time > 2000 || rate < 80) {
                return {
                    class:
                        "bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",
                    icon: "fa-exclamation-triangle",
                    text: "Warning",
                };
            } else {
                return {
                    class:
                        "bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",
                    icon: "fa-check-circle",
                    text: "Healthy",
                };
            }
        }

        function displayApiTable(apis) {
            const tbody = document.getElementById("apiTableBody");
            tbody.innerHTML = "";

            apis.forEach((api, index) => {
                const statusInfo = getStatusInfo(
                    api.avgResTime,
                    api.statusCheck.successRate
                );
                const successRate = api.statusCheck.successRate || "100%";

                const row = document.createElement("tr");
                row.className =
                    "row-hover theme-transition bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700";
                row.innerHTML = `
                    <td class="px-6 py-4">
                        <div class="flex flex-col">
                            <span class="font-semibold text-gray-900 dark:text-gray-100">${api.apiName}</span>
                            <span class="text-xs text-gray-500 dark:text-gray-400 mt-1 truncate max-w-xs" title="${api.apiUrl}">
                                <i class="fas fa-link mr-1"></i>${api.apiUrl}
                            </span>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <span class="font-mono text-sm font-semibold text-blue-600 dark:text-blue-400">${api.avgResTime}</span>
                    </td>
                    <td class="px-6 py-4">
                        <span class="font-mono text-sm text-green-600 dark:text-green-400">${api.minResTime}</span>
                    </td>
                    <td class="px-6 py-4">
                        <span class="font-mono text-sm text-red-600 dark:text-red-400">${api.maxResTime}</span>
                    </td>
                    <td class="px-6 py-4">
                        <span class="font-mono text-sm text-gray-700 dark:text-gray-300">${api.p90}</span>
                    </td>
                    <td class="px-6 py-4">
                        <span class="font-mono text-sm text-gray-700 dark:text-gray-300">${api.p95}</span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mr-2">
                                <div class="bg-green-500 h-2 rounded-full" style="width: ${successRate}"></div>
                            </div>
                            <span class="text-sm font-semibold text-gray-700 dark:text-gray-300">${successRate}</span>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <span class="status-badge inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold ${statusInfo.class}">
                            <i class="fas ${statusInfo.icon} mr-1"></i>
                            ${statusInfo.text}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function displayIssues(issues) {
            const issuesList = document.getElementById("issuesList");
            issuesList.innerHTML = "";

            if (issues.length === 0) {
                issuesList.innerHTML =
                    '<p class="text-gray-600 dark:text-gray-400">No critical issues detected. All APIs are performing well!</p>';
                return;
            }

            issues.forEach((issue) => {
                const issueCard = document.createElement("div");
                issueCard.className =
                    "theme-transition bg-red-50 dark:bg-red-900/20 border-l-4 border-red-500 p-4 rounded-lg";
                issueCard.innerHTML = `
                    <div class="flex items-start">
                        <i class="fas fa-exclamation-triangle text-red-500 mt-1 mr-3"></i>
                        <div class="flex-1">
                            <h3 class="font-bold text-gray-900 dark:text-gray-100">${issue.apiName}</h3>
                            <p class="text-sm text-gray-700 dark:text-gray-300 mt-1">${issue.issue}</p>
                            <p class="text-sm text-red-600 dark:text-red-400 mt-2">
                                <i class="fas fa-chart-line mr-1"></i>Success Rate: ${issue.successRate}
                            </p>
                        </div>
                    </div>
                `;
                issuesList.appendChild(issueCard);
            });
        }

        // Search and Filter
        document.getElementById("searchInput").addEventListener("input", (e) => {
            filterAndDisplay();
        });

        function filterAndDisplay() {
            const searchTerm = document
                .getElementById("searchInput")
                .value.toLowerCase();
            const filterStatus = currentFilterStatus;

            let filteredApis = allApiData.filter((api) => {
                const matchesSearch =
                    api.apiName.toLowerCase().includes(searchTerm) ||
                    api.apiUrl.toLowerCase().includes(searchTerm);

                if (!matchesSearch) return false;

                if (filterStatus === "all") return true;

                const avgTime = parseFloat(api.avgResTime);
                const successRate = api.statusCheck.successRate
                    ? parseInt(api.statusCheck.successRate)
                    : 100;

                if (filterStatus === "healthy") {
                    return avgTime < 2000 && successRate >= 80;
                } else if (filterStatus === "warning") {
                    return (
                        (avgTime >= 2000 && avgTime <= 5000) ||
                        (successRate >= 50 && successRate < 80)
                    );
                } else if (filterStatus === "critical") {
                    return avgTime > 5000 || successRate < 50;
                }

                return true;
            });

            displayApiTable(filteredApis);
        }

        // Initialize
        document.addEventListener("DOMContentLoaded", () => {
            initTheme();
            initDropdown();
            loadData();
        });
    </script>
</body>

</html>